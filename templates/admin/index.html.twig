{% extends 'base.html.twig' %}
{% block body %}
	<div class="container-fluid py-4">
		<div class="row">

			<div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
				<div class="card">
					<div class="card-header p-3 pt-2">
						<div class="icon icon-lg icon-shape bg-gradient-dark shadow-dark text-center border-radius-xl mt-n4 position-absolute">
							<i class="material-icons opacity-10">{{ dayOfWeek }}</i>
						</div>
						<div class="text-end pt-1">
							<p class="text-sm mb-0 text-capitalize">Today's Money</p>
							<h4 class="mb-0">{{ totalMoneyToday|number_format(2, '.', ',') }}
								TND</h4>
						</div>
					</div>
					<hr class="dark horizontal my-0">
					<div class="card-footer p-3">
						<p class="mb-0">
							{% if percentageChange < 0 %}
								<span class="text-danger text-sm font-weight-bolder">
								{% else %}
									<span class="text-success text-sm font-weight-bolder">
									{% endif %}
									{{ percentageChange|number_format(2, '.', ',') }}%
								</span>
								than last week</p>
						</p>
					</div>
				</div>
			</div>


			<div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
				<div class="card">
					<div class="card-header p-3 pt-2">
						<div class="icon icon-lg icon-shape bg-gradient-primary shadow-primary text-center border-radius-xl mt-n4 position-absolute">
							<i class="material-icons opacity-10">{{ dayOfWeek }}</i>
						</div>
						<div class="text-end pt-1">
							<p class="text-sm mb-0 text-capitalize">Total Users</p>
							<h4 class="mb-0">{{ totalUsers|number_format(0, '.', ',') }}</h4>
						</div>
					</div>
					<hr class="dark horizontal my-0">
					<div class="card-footer p-3">
						<p class="mb-0">Our new users</p>
					</div>
				</div>
			</div>

			<div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
				<div class="card">
					<div class="card-header p-3 pt-2">
						<div class="icon icon-lg icon-shape bg-gradient-success shadow-success text-center border-radius-xl mt-n4 position-absolute">
							<i class="material-icons opacity-10">{{ dayOfWeek }}</i>
						</div>
						<div class="text-end pt-1">
							<p class="text-sm mb-0 text-capitalize">Total Orders</p>
							<h4 class="mb-0">{{ totalOrders }}</h4>
						</div>
					</div>
					<hr class="dark horizontal my-0">
					<div class="card-footer p-3">
						<p class="mb-0">
							<span class="text-success text-sm font-weight-bolder">Keep Going !!!!!</span>
							
						</p>
					</div>
				</div>
			</div>

			<div class="col-xl-3 col-sm-6">
				<div class="card">
					<div class="card-header p-3 pt-2">
						<div class="icon icon-lg icon-shape bg-gradient-info shadow-info text-center border-radius-xl mt-n4 position-absolute">
							<i class="material-icons opacity-10">{{ dayOfWeek }}</i>
						</div>
						{% if mostOrderedBook %}
							<div class="text-end pt-1">
								<p class="text-sm mb-0 text-capitalize">Most Wanted</p>
								<h4 class="mb-0">{{ mostOrderedBook.getTitre() }}</h4>
							</div>
						{% else %}
							<div class="text-end pt-1">
								<p class="text-sm mb-0 text-capitalize">Most</p>
								<h4 class="mb-0">Not found</h4>
							</div>
						{% endif %}
					</div>
					<hr class="dark horizontal my-0">
					<div class="card-footer p-3">
						<p class="mb-0">Le dernier mise à jour
							<span class="text-success text-sm font-weight-bolder">{{ lastOrderDate|date('Y-m-d H:i:s') }}</span>
						</p>
					</div>
				</div>
			</div>
			<div class="mt-3 row">
				<div class="mt-2 col-6">
					<h2 class="text-center">Sales Etat Chart</h2>
					<div id="chart_div_1" style="width: 100%; height: 500px;"></div>
				</div>
				<div class="mt-2 col-6">
					<h2 class="text-center">Ventes par Etat</h2>
					<div id="chart_div_2" style="width: 100%; height: 500px;"></div>
				</div>
			</div>
		</div>
	</div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Date', 'En attente','Confirmer', 'En cours', 'Livre', 'Annuler'],
			{% for order in orders %}
				['{{ order.createAt|date('y-m-d') }}', '{{ order.etat.etat }}' == "en attente" ? 1:0 ,'{{ order.etat.etat }}' == "confirmer" ? 1:0, '{{ order.etat.etat  }}' == "en cours" ? 1:0, '{{ order.etat.etat }}' == "livrée" ? 1:0 ,'{{ order.etat.etat }}' == "annulée" ? 1:0	],
			{% endfor %}
        ]);

		console.log(data);

        var options = {
          title: 'Ventes par Etat',
          hAxis: {title: 'Ventes' ,  titleTextStyle: {color: '#333'}},
          vAxis: {minValue: 0}
        };

        var chart = new google.visualization.AreaChart(document.getElementById('chart_div_1'));
        chart.draw(data, options);
      }

    </script>

	<script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart2);

      function drawChart2() {
		var Data = [
			{"en attente" : 0},
			{"confirmer" : 0},
			{"en cours" : 0},
			{"livrée" : 0},
			{"annulée" : 0}
		]
		{% for order in orders %}
			Data.forEach(function(item){
				if('{{ order.etat.etat }}' == Object.keys(item)[0]){
					item['{{ order.etat.etat }}'] += 1;
				}
			});
		{% endfor %}
		console.log(Data);
		var data = google.visualization.arrayToDataTable([
          ['Etat', 'Ventes'],
		  ['En attente', Data[0]['en attente']],
		  ['Confirmer', Data[1]['confirmer']],
		  ['En cours', Data[2]['en cours']],
		  ['Livrée', Data[3]['livrée']],
		  ['Annulée', Data[4]['annulée']]
          
        ]);

		console.log(Data);

        var options = {
          title: 'My Daily Activities',
          is3D: true,
        };

        var chart = new google.visualization.PieChart(document.getElementById('chart_div_2'));
        chart.draw(data, options);
      }
    </script>
{% endblock %}
